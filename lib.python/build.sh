#!/bin/bash
set -e

API_DATA="../api_data.json"
SRC="rudder.py.src"
DST="rudder.py"
OPENAPI_DST="rudder-openapi.py"
GENERATOR="generate.py"
OPENAPI_GENERATOR="generate-openapi.py"
DELIMITER="#### Autogenerated code, DO NOT MODIFY"
TEMP="./temp"
PYTHON_BINARY="/usr/bin/python"
if command -v python3 &>/dev/null; then
    PYTHON_BINARY="/usr/bin/python3"
fi
# apidoc
${PYTHON_BINARY} ${GENERATOR} > ${TEMP}
sed "/${DELIMITER}/r${TEMP}" ${SRC} > ${DST}
#openapi
${PYTHON_BINARY} ${OPENAPI_GENERATOR} > ${TEMP}
sed "/${DELIMITER}/r${TEMP}" ${SRC} > ${OPENAPI_DST}

rm "${TEMP}"
